{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row">
        <!-- Se√ß√£o principal: Detalhes da Tarefa -->
        <div class="col-md-8">
            <h1>Detalhes da Tarefa</h1>
            
            {% if not editing %}
            <div id="task-details">
                <p><strong>Projeto:</strong> {{ task.title }}</p>
                <p><strong>Descri√ß√£o:</strong> {{ task.description }}</p>
                <p><strong>Status:</strong>
                    {% if task.status == 'P' %} Pendente
                    {% elif task.status == 'A' %} Em Andamento
                    {% elif task.status == 'C' %} Conclu√≠do
                    {% endif %}
                </p>
                <p><strong>Data de cria√ß√£o:</strong> {{ task.created_at|date:"d/m/Y H:i" }}</p>
                <p><strong>Data de Entrega:</strong> {{ task.due_date|date:"d/m/Y" }}</p>

                <!-- Lista de Colaboradores -->
                <h2>Colaboradores</h2>
                <ul>
                    {% for user in task.collaborators.all %}
                        <li>{{ user.username }}</li>
                    {% endfor %}
                </ul>

                <a href="?editing=true" class="btn btn-warning">Editar</a>
            </div>
            {% endif %}

            <!-- Formul√°rio de Edi√ß√£o -->
            {% if editing %}
            <div id="task-edit">
                <h2>Editar Tarefa</h2>
                <form method="POST" class="form">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <a href="?editing=false" class="btn btn-secondary">Cancelar</a>
                </form>
            </div>
            {% endif %}

            <a href="{% url 'task-list' %}" class="btn btn-secondary mt-2">Voltar √† Lista</a>
        </div>

        <!-- Caixa lateral: Arquivos Relacionados -->
        <div class="col-md-4">
            <h2>Arquivos Relacionados</h2>
            <ul>
                {% for doc in task.documents.all %}
                    <li>
                        {% if doc.file %}
                            <a href="{{ doc.file.url }}" target="_blank">{{ doc.file.name }}</a>
                        {% elif doc.onedrive_link %}
                            <a href="{{ doc.onedrive_link }}" target="_blank">üîó Link do OneDrive</a>
                        {% endif %}
                        <a href="{% url 'file-delete' pk=doc.pk %}" class="btn btn-danger btn-sm">Excluir</a>
                    </li>
                {% endfor %}
            </ul>

            <!-- Formul√°rio para adicionar novo arquivo ou link -->
            <h3>Adicionar Novo Arquivo ou Link do OneDrive</h3>
            <form method="POST" enctype="multipart/form-data" action="{% url 'file-upload' pk=task.pk %}">
                {% csrf_token %}
                
                <label for="file">Selecionar Arquivo:</label>
                <input type="file" name="file" id="file" class="form-control">
            
                <label for="onedrive_link">Adicionar Link do OneDrive:</label>
                <input type="url" name="onedrive_link" id="onedrive_link" class="form-control">
            
                <button type="submit" class="btn btn-success mt-2">Enviar</button>
            </form>
    </div>
</div>
{% endblock %}
